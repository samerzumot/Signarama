<!-- RENDER LOGIC -->
{% if title %}
  <!-- JSON-LD Structured Data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "Service",
    "name": "{{ title }}",
    "image": [
      {% if main_image contains 'http' %}"{{ main_image }}"{% else %}"{{ main_image | asset_url }}"{% endif %}
    ],
    "description": "{{ description }}",
    "provider": {
      "@type": "LocalBusiness",
      "name": "Signarama Vaughan",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "3300 Steeles Ave W",
        "addressLocality": "Vaughan",
        "addressRegion": "ON",
        "postalCode": "L4K 2Y4",
        "addressCountry": "CA"
      },
      "telephone": "+19056699313"
    },
    "areaServed": "Toronto, Vaughan, Richmond Hill, Markham"
  }
  </script>

  <!-- Page Content -->
  <!-- Padding increased to 160px to clear fixed header on desktop -->
  <div class="product-details-page">
    <div class="page-width container">
      
      <!-- Hero / Main Product Section -->
      <div class="product-hero">
        <div class="product-image-container">
           {% if main_image contains 'http' %}
             <img src="{{ main_image }}" alt="{{ title }} - Main Image" id="main-product-image" width="800" height="600" style="width: 100%; height: auto; object-fit: contain;">
           {% else %}
             <img src="{{ main_image | asset_url }}" alt="{{ title }} - Main Image" id="main-product-image" width="800" height="600" style="width: 100%; height: auto; object-fit: contain;">
           {% endif %}
        </div>
        
        <div class="product-info">
          <h1 class="product-title">{{ title }}</h1>
          <p class="product-description-short">{{ description }}</p>
          <p class="product-description-long">{{ long_description }}</p>
          
          <div class="cta-wrapper">
             <button id="product-quote-trigger" class="btn-primary" data-product="{{ title }}">Get {{ title }} Quote</button>
          </div>
        </div>
      </div>

      <hr style="margin: 3rem 0; border: 0; border-top: 1px solid #eee;">

      <!-- Image Gallery (Horizontal Scroll) - Header Removed -->
      <div class="product-gallery">
        <div class="gallery-scroll-container">
          {% for img in gallery_images %}
            <div class="gallery-item">
              {% if img contains 'http' %}
                 <img src="{{ img }}" alt="{{ title }} Gallery Image {{ forloop.index }}" loading="lazy">
              {% else %}
                 <img src="{{ img | asset_url }}" alt="{{ title }} Gallery Image {{ forloop.index }}" loading="lazy">
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>

    </div>
  </div>

  <!-- SELF-CONTAINED QUOTE MODAL -->
  <div id="product-quote-modal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
      <div class="modal-content" style="background: white; padding: 2rem; border-radius: 8px; width: 90%; max-width: 500px; position: relative; max-height: 90vh; overflow-y: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
        <button class="modal-close" id="product-close-modal" style="position: absolute; top: 10px; right: 15px; font-size: 28px; line-height: 1; border: none; background: none; cursor: pointer; color: #555;">&times;</button>
        
        <h2 style="text-align: center; color: #d32f2f; margin-bottom: 1.5rem; margin-top: 0;">Request a Quote</h2>
        
        <form id="product-quote-form" action="https://formsubmit.co/info@signarama-vaughan.com" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="_subject" value="New Quote Request - Signarama Vaughan">
            <input type="hidden" name="_captcha" value="false">
            <input type="hidden" name="_template" value="table">
            <input type="text" name="_honey" style="display:none">

            <div class="form-group" style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Name</label>
              <input type="text" required name="name" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div class="form-group" style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Email Address *</label>
              <input type="email" required name="email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div class="form-group" style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Phone Number *</label>
              <input type="tel" required name="phone" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div class="form-group" style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">Project Details</label>
              <textarea rows="4" name="message" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            </div>
            
            <button type="submit" class="btn-submit" style="width: 100%; background: #d32f2f; color: white; padding: 14px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 1.1rem; margin-top: 10px;">Send Request</button>
        </form>
      </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var quoteBtn = document.getElementById('product-quote-trigger');
      var modal = document.getElementById('product-quote-modal');
      var closeBtn = document.getElementById('product-close-modal');
      
      if (quoteBtn && modal) {
        // OPEN
        quoteBtn.addEventListener('click', function(e) {
          e.preventDefault();
          var productName = this.getAttribute('data-product');
          var messageArea = modal.querySelector('textarea[name="message"]');
          if (messageArea) {
             messageArea.value = "I am interested in a quote for " + productName + ".";
          }
          modal.style.display = 'flex'; 
          document.body.style.overflow = 'hidden';
        });

        // CLOSE
        if(closeBtn) {
            closeBtn.addEventListener('click', function() {
              modal.style.display = 'none';
              document.body.style.overflow = '';
            });
        }

        // CLICK OUTSIDE
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        });
      }

      // Gallery Logic
      var mainImage = document.getElementById('main-product-image');
      if (mainImage) {
          var items = document.querySelectorAll('.gallery-item img');
          for (var i = 0; i < items.length; i++) {
              items[i].addEventListener('click', function() {
                  mainImage.src = this.src;
              });
              items[i].style.cursor = 'pointer';
          }
      }
    });
  </script>

  <style>
    .product-details-page {
      padding: 160px 0 60px 0; /* Huge top padding for fixed header */
    }
    .page-width.container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
    }
    .product-hero {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      margin-bottom: 4rem;
      align-items: center;
    }
    .product-title {
      font-size: 2.5rem;
      font-weight: 800;
      color: #d32f2f;
      margin-bottom: 1rem;
      line-height: 1.1;
    }
    .product-description-short {
      font-size: 1.3rem;
      font-weight: 700;
      color: #222;
      margin-bottom: 1.5rem;
    }
    .product-description-long {
      font-size: 1.1rem;
      line-height: 1.7;
      color: #555;
      margin-bottom: 2.5rem;
    }
    
    /* Horizontal Scroll Gallery */
    .gallery-scroll-container {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      padding-bottom: 15px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .gallery-item {
      flex: 0 0 280px; 
      height: 200px;
      scroll-snap-align: start;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .gallery-item:hover {
      transform: translateY(-2px);
    }
    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .btn-primary {
      background-color: #d32f2f;
      color: white !important;
      padding: 1.2rem 2.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1.2rem;
      font-weight: 800;
      cursor: pointer;
      text-transform: uppercase;
      text-decoration: none;
      display: inline-block;
      transition: background-color 0.2s;
      box-shadow: 0 4px 12px rgba(211, 47, 47, 0.3);
    }
    .btn-primary:hover {
      background-color: #b01f15;
    }

    @media (max-width: 900px) {
      .product-details-page {
          padding-top: 140px;
      }
      .product-hero {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      .cta-wrapper {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 1rem;
        background: white;
        box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
        z-index: 1000;
        text-align: center;
      }
      .btn-primary {
        width: 100%;
        font-size: 1.1rem;
      }
      .page-width.container {
        padding-bottom: 100px; /* Space for fixed bottom CTA */
      }
      .gallery-item {
        flex: 0 0 200px;
        height: 150px;
      }
    }
  </style>

{% else %}
  <div class="container page-width" style="padding: 150px 0; text-align: center;">
    <h2>Product Not Found</h2>
    <p>We could not retrieve details for: <strong>{{ handle }}</strong></p>
    <a href="/pages/contact-us" class="btn-primary" style="display:inline-block; margin-top:1rem;">Contact Us</a>
  </div>
{% endif %}
